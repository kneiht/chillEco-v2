<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Test Page</title>
    <style>
      :root {
        --bg-color: #1a1a1a;
        --text-color: #f0f0f0;
        --primary-color: #007bff;
        --primary-hover-color: #0056b3;
        --danger-color: #dc3545;
        --danger-hover-color: #c82333;
        --card-bg-color: #2a2a2a;
        --input-bg-color: #3a3a3a;
        --input-border-color: #555;
        --pre-bg-color: #111;
        --tab-bg-color: #2a2a2a;
        --tab-active-bg-color: #3a3a3a;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        margin: 2em;
        background-color: var(--bg-color);
        color: var(--text-color);
      }

      .tabs {
        display: flex;
        border-bottom: 2px solid var(--primary-color);
      }

      .tab-button {
        padding: 10px 20px;
        cursor: pointer;
        background-color: var(--tab-bg-color);
        border: none;
        color: var(--text-color);
        font-size: 16px;
        transition: background-color 0.2s;
      }

      .tab-button:hover {
        background-color: var(--tab-active-bg-color);
      }

      .tab-button.active {
        background-color: var(--primary-color);
      }

      .tab-content {
        display: none;
        padding: 20px 0;
      }

      .tab-content.active {
        display: block;
      }

      .content-grid {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2em;
      }

      .card {
        background-color: var(--card-bg-color);
        border: 1px solid var(--input-border-color);
        padding: 1.5em;
        border-radius: 8px;
        margin-bottom: 1em;
        overflow: auto;
      }

      button {
        padding: 0.6em 1.2em;
        border: none;
        background-color: var(--primary-color);
        color: white;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
        margin-top: 10px;
      }

      button:hover {
        background-color: var(--primary-hover-color);
      }

      button.danger {
        background-color: var(--danger-color);
      }

      button.danger:hover {
        background-color: var(--danger-hover-color);
      }

      input,
      textarea {
        width: calc(100% - 1.2em);
        padding: 0.6em;
        margin-bottom: 0.5em;
        border: 1px solid var(--input-border-color);
        background-color: var(--input-bg-color);
        color: var(--text-color);
        border-radius: 5px;
      }

      .content-grid > div {
        min-width: 0;
      }

      pre {
        background-color: var(--pre-bg-color);
        color: #f1f1f1;
        padding: 1em;
        border-radius: 5px;
        white-space: pre-wrap;
        overflow-wrap: break-word;
        font-family: 'Fira Code', 'Courier New', Courier, monospace;
        min-height: 50px;
        max-height: 300px;
        overflow: auto;
      }

      form {
        display: flex;
        flex-direction: column;
      }
    </style>
  </head>
  <body>
    <div class="tabs">
      <button class="tab-button active" onclick="openTab(event, 'auth')">Auth</button>
      <button class="tab-button" onclick="openTab(event, 'user-management')">
        User Management
      </button>
      <button class="tab-button" onclick="openTab(event, 'post-management')">
        Post Management
      </button>
    </div>

    <div id="auth" class="tab-content active">
      <div class="content-grid">
        <div>
          <div class="card">
            <h2>Register User</h2>
            <form id="register-form">
              <input type="text" id="register-name" placeholder="Name" required />
              <input type="email" id="register-email" placeholder="Email" required />
              <input type="password" id="register-password" placeholder="Password" required />
              <button type="submit">Register</button>
            </form>
          </div>
          <div class="card">
            <h2>Login User</h2>
            <form id="login-form">
              <input type="email" id="login-email" placeholder="Email" required />
              <input type="password" id="login-password" placeholder="Password" required />
              <button type="submit">Login</button>
            </form>
          </div>
          <div class="card">
            <h2>Access Token</h2>
            <textarea id="access-token" rows="5"></textarea>
            <button id="copy-token-btn">Copy Token</button>
            <button id="check-token-btn" style="margin-top: 5px;">Check Token</button>
          </div>
        </div>
        <div>
          <div class="card">
            <h2>Request Data</h2>
            <pre id="auth-request-data"></pre>
            <h2>Response Data</h2>
            <pre id="auth-response-data"></pre>
          </div>
        </div>
      </div>
    </div>

    <div id="user-management" class="tab-content">
      <div class="content-grid">
        <div>
          <div class="card">
            <h2>Authorization</h2>
            <textarea
              id="user-mgmt-token"
              placeholder="Login to get a token and copy it here"
              rows="5"
            ></textarea>
          </div>
          <div class="card">
            <h2>Get All Users</h2>
            <button id="get-users-btn">Fetch All Users</button>
          </div>
          <div class="card">
            <h2>Get/Delete by ID</h2>
            <form id="get-delete-user-form">
              <input type="text" id="user-id" placeholder="User ID" required />
              <button type="button" id="get-user-by-id-btn">Get User</button>
              <button type="button" id="delete-user-btn" class="danger" style="margin-top: 5px">
                Delete User
              </button>
            </form>
          </div>
          <div class="card">
            <h2>Update User</h2>
            <form id="update-user-form">
              <input type="text" id="update-id" placeholder="User ID to Update" required />
              <input type="text" id="update-name" placeholder="New Name (optional)" />
              <input type="email" id="update-email" placeholder="New Email (optional)" />
              <button type="submit">Update User</button>
            </form>
          </div>
        </div>
        <div>
          <div class="card">
            <h2>Request Data</h2>
            <pre id="user-request-data"></pre>
            <h2>Response Data</h2>
            <pre id="user-response-data"></pre>
          </div>
        </div>
      </div>
    </div>

    <div id="post-management" class="tab-content">
        <div class="content-grid">
          <div>
            <div class="card">
              <h2>Authorization</h2>
              <textarea
                id="post-mgmt-token"
                placeholder="Login to get a token and copy it here"
                rows="5"
              ></textarea>
            </div>
            <div class="card">
              <h2>Get All Posts</h2>
              <button id="get-posts-btn">Fetch All Posts</button>
            </div>
            <div class="card">
              <h2>Create Post</h2>
              <form id="create-post-form">
                <input type="text" id="create-post-title" placeholder="Title" required />
                <textarea id="create-post-content" placeholder="Content" required></textarea>
                <button type="submit">Create Post</button>
              </form>
            </div>
            <div class="card">
              <h2>Get/Update/Delete by ID</h2>
              <form id="gud-post-form">
                <input type="text" id="post-id" placeholder="Post ID" required />
                <input type="text" id="update-post-title" placeholder="New Title (for update)" />
                <textarea id="update-post-content" placeholder="New Content (for update)"></textarea>
                <button type="button" id="get-post-by-id-btn">Get Post</button>
                <button type="button" id="update-post-btn" style="margin-top: 5px;">Update Post</button>
                <button type="button" id="delete-post-btn" class="danger" style="margin-top: 5px">
                  Delete Post
                </button>
              </form>
            </div>
          </div>
          <div>
            <div class="card">
              <h2>Request Data</h2>
              <pre id="post-request-data"></pre>
              <h2>Response Data</h2>
              <pre id="post-response-data"></pre>
            </div>
          </div>
        </div>
      </div>

    <script>
      function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName('tab-content');
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = 'none';
        }
        tablinks = document.getElementsByClassName('tab-button');
        for (i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(' active', '');
        }
        document.getElementById(tabName).style.display = 'block';
        evt.currentTarget.className += ' active';
      }

      document.addEventListener('DOMContentLoaded', () => {
        const API_URL = 'http://localhost:3000';
        let accessToken = '';

        const authRequestData = document.getElementById('auth-request-data');
        const authResponseData = document.getElementById('auth-response-data');
        const userRequestData = document.getElementById('user-request-data');
        const userResponseData = document.getElementById('user-response-data');
        const postRequestData = document.getElementById('post-request-data');
        const postResponseData = document.getElementById('post-response-data');

        const accessTokenElement = document.getElementById('access-token');
        const userMgmtTokenElement = document.getElementById('user-mgmt-token');
        const postMgmtTokenElement = document.getElementById('post-mgmt-token');

        const displayRequest = (element, method, url, headers, body) => {
          let reqString = `Method: ${method}\nURL: ${url}`;
          if (headers) {
            reqString += `\nHeaders: ${JSON.stringify(headers, null, 2)}`;
          }
          if (body) {
            reqString += `\nBody: ${JSON.stringify(body, null, 2)}`;
          }
          element.textContent = reqString;
        };

        const displayResponse = (element, data) => {
          element.textContent = JSON.stringify(data, null, 2);
        };

        // --- Register User ---
        const registerForm = document.getElementById('register-form');
        registerForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const name = document.getElementById('register-name').value;
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;
          const body = { name, email, password };
          const url = `${API_URL}/auth/register`;
          displayRequest(authRequestData, 'POST', url, null, body);
          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body),
            });
            const data = await response.json();
            displayResponse(authResponseData, data);
          } catch (error) {
            displayResponse(authResponseData, { error: error.message });
          }
        });

        // --- Login User ---
        const loginForm = document.getElementById('login-form');
        loginForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('login-email').value;
          const password = document.getElementById('login-password').value;
          const body = { email, password };
          const url = `${API_URL}/auth/login`;
          displayRequest(authRequestData, 'POST', url, null, body);
          try {
            const response = await fetch(url, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(body),
            });
            const data = await response.json();
            displayResponse(authResponseData, data);
            if (response.ok && data.data.token) {
              accessToken = data.data.token;
              accessTokenElement.value = accessToken;
            }
          } catch (error) {
            displayResponse(authResponseData, { error: error.message });
          }
        });

        // --- Copy Token ---
        const copyTokenBtn = document.getElementById('copy-token-btn');
        copyTokenBtn.addEventListener('click', () => {
          userMgmtTokenElement.value = accessTokenElement.value;
          postMgmtTokenElement.value = accessTokenElement.value;
        });

        // --- Check Token ---
        const checkTokenBtn = document.getElementById('check-token-btn');
        checkTokenBtn.addEventListener('click', async () => {
          const token = accessTokenElement.value;
          if (!token) {
            displayResponse(authResponseData, { error: 'Access token is empty.' });
            return;
          }

          const url = `${API_URL}/auth/check`;
          const headers = { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` };
          displayRequest(authRequestData, 'GET', url, headers);

          try {
            const response = await fetch(url, { headers });
            const data = await response.json();
            displayResponse(authResponseData, data);
          } catch (error) {
            displayResponse(authResponseData, { error: error.message });
          }
        });

        const getAuthHeaders = (tokenElement) => {
          const token = tokenElement.value;
          if (!token) return { 'Content-Type': 'application/json' };
          return { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` };
        };

        // --- Get All Users ---
        const getUsersBtn = document.getElementById('get-users-btn');
        getUsersBtn.addEventListener('click', async () => {
          const url = `${API_URL}/users`;
          const headers = getAuthHeaders(userMgmtTokenElement);
          displayRequest(userRequestData, 'GET', url, headers);
          try {
            userResponseData.textContent = 'Loading...';
            const response = await fetch(url, { headers });
            const data = await response.json();
            displayResponse(userResponseData, data);
          } catch (error) {
            displayResponse(userResponseData, { error: error.message });
          }
        });

        // --- Get User by ID ---
        const getUserByIdBtn = document.getElementById('get-user-by-id-btn');
        getUserByIdBtn.addEventListener('click', async () => {
          const id = document.getElementById('user-id').value;
          if (!id) {
            displayResponse(userResponseData, { error: 'Please enter a User ID.' });
            return;
          }
          const url = `${API_URL}/users/${id}`;
          const headers = getAuthHeaders(userMgmtTokenElement);
          displayRequest(userRequestData, 'GET', url, headers);
          try {
            const response = await fetch(url, { headers });
            const data = await response.json();
            displayResponse(userResponseData, data);
          } catch (error) {
            displayResponse(userResponseData, { error: error.message });
          }
        });

        // --- Delete User ---
        const deleteUserBtn = document.getElementById('delete-user-btn');
        deleteUserBtn.addEventListener('click', async () => {
          const id = document.getElementById('user-id').value;
          if (!id) {
            displayResponse(userResponseData, { error: 'Please enter a User ID.' });
            return;
          }
          if (!confirm(`Are you sure you want to delete user ${id}?`)) return;
          const url = `${API_URL}/users/${id}`;
          const headers = getAuthHeaders(userMgmtTokenElement);
          displayRequest(userRequestData, 'DELETE', url, headers);
          try {
            const response = await fetch(url, { method: 'DELETE', headers });
            displayResponse(userResponseData, {
              status: response.status,
              statusText: response.statusText,
            });
          } catch (error) {
            displayResponse(userResponseData, { error: error.message });
          }
        });

        // --- Update User ---
        const updateUserForm = document.getElementById('update-user-form');
        updateUserForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          const id = document.getElementById('update-id').value;
          const name = document.getElementById('update-name').value;
          const email = document.getElementById('update-email').value;

          const body = {};
          if (name) body.name = name;
          if (email) body.email = email;

          if (Object.keys(body).length === 0) {
            displayResponse(userResponseData, {
              error: 'Please provide a new name or email to update.',
            });
            return;
          }
          const url = `${API_URL}/users/${id}`;
          const headers = getAuthHeaders(userMgmtTokenElement);
          displayRequest(userRequestData, 'PUT', url, headers, body);

          try {
            const response = await fetch(url, {
              method: 'PUT',
              headers,
              body: JSON.stringify(body),
            });
            const data = await response.json();
            displayResponse(userResponseData, data);
          } catch (error) {
            displayResponse(userResponseData, { error: error.message });
          }
        });

        // --- Get All Posts ---
        const getPostsBtn = document.getElementById('get-posts-btn');
        getPostsBtn.addEventListener('click', async () => {
            const url = `${API_URL}/posts`;
            const headers = getAuthHeaders(postMgmtTokenElement);
            displayRequest(postRequestData, 'GET', url, headers);
            try {
                postResponseData.textContent = 'Loading...';
                const response = await fetch(url, { headers });
                const data = await response.json();
                displayResponse(postResponseData, data);
            } catch (error) {
                displayResponse(postResponseData, { error: error.message });
            }
        });

        // --- Create Post ---
        const createPostForm = document.getElementById('create-post-form');
        createPostForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('create-post-title').value;
            const content = document.getElementById('create-post-content').value;
            const body = { title, content };
            const url = `${API_URL}/posts`;
            const headers = getAuthHeaders(postMgmtTokenElement);
            displayRequest(postRequestData, 'POST', url, headers, body);
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers,
                    body: JSON.stringify(body),
                });
                const data = await response.json();
                displayResponse(postResponseData, data);
            } catch (error) {
                displayResponse(postResponseData, { error: error.message });
            }
        });

        // --- Get Post by ID ---
        const getPostByIdBtn = document.getElementById('get-post-by-id-btn');
        getPostByIdBtn.addEventListener('click', async () => {
            const id = document.getElementById('post-id').value;
            if (!id) {
                displayResponse(postResponseData, { error: 'Please enter a Post ID.' });
                return;
            }
            const url = `${API_URL}/posts/${id}`;
            const headers = getAuthHeaders(postMgmtTokenElement);
            displayRequest(postRequestData, 'GET', url, headers);
            try {
                const response = await fetch(url, { headers });
                const data = await response.json();
                displayResponse(postResponseData, data);
            } catch (error) {
                displayResponse(postResponseData, { error: error.message });
            }
        });

        // --- Update Post ---
        const updatePostBtn = document.getElementById('update-post-btn');
        updatePostBtn.addEventListener('click', async () => {
            const id = document.getElementById('post-id').value;
            const title = document.getElementById('update-post-title').value;
            const content = document.getElementById('update-post-content').value;

            if (!id) {
                displayResponse(postResponseData, { error: 'Please enter a Post ID.' });
                return;
            }

            const body = {};
            if (title) body.title = title;
            if (content) body.content = content;

            if (Object.keys(body).length === 0) {
                displayResponse(postResponseData, {
                    error: 'Please provide a new title or content to update.',
                });
                return;
            }
            const url = `${API_URL}/posts/${id}`;
            const headers = getAuthHeaders(postMgmtTokenElement);
            displayRequest(postRequestData, 'PUT', url, headers, body);

            try {
                const response = await fetch(url, {
                    method: 'PUT',
                    headers,
                    body: JSON.stringify(body),
                });
                const data = await response.json();
                displayResponse(postResponseData, data);
            } catch (error) {
                displayResponse(postResponseData, { error: error.message });
            }
        });

        // --- Delete Post ---
        const deletePostBtn = document.getElementById('delete-post-btn');
        deletePostBtn.addEventListener('click', async () => {
            const id = document.getElementById('post-id').value;
            if (!id) {
                displayResponse(postResponseData, { error: 'Please enter a Post ID.' });
                return;
            }
            if (!confirm(`Are you sure you want to delete post ${id}?`)) return;
            const url = `${API_URL}/posts/${id}`;
            const headers = getAuthHeaders(postMgmtTokenElement);
            displayRequest(postRequestData, 'DELETE', url, headers);
            try {
                const response = await fetch(url, { method: 'DELETE', headers });
                displayResponse(postResponseData, {
                    status: response.status,
                    statusText: response.statusText,
                });
            } catch (error) {
                displayResponse(postResponseData, { error: error.message });
            }
        });
      });
    </script>
  </body>
</html>